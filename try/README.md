# 设计概述

1. 宗旨：简化
   尽量简化定义。凡是当前用不到的就去掉，以保证开发同时保持敏捷和可靠。
2. 目标：中层接口
   因为不是面向用户开发，不需要考虑接口易用性，也不需要过度考虑防御式编程。调用这些 api 的将会是第一方编写的上层代码。
3. 文档
   覆盖率应逼近 100%。

## 代码解析

`graph.h` 主要包含了定义在计算图中使用的数据结构、操作和功能函数。

- `struct TensorPos` 保存计算图中一个张量的位置。
- `struct Tensor` 表示计算图中的一个张量。包含张量的形状、元素数据类型、数据本身、以及生成该张量的操作符和使用该张量的操作符等信息。同时还定义了一个静态工厂方法 `share()`，用于创建 `std::shared_ptr<Tensor>` 实例。
- `struct Operator` 表示计算图中的一个算子，由算子的类型和输入输出张量构成。由于一个张量可能被多个共享，因此张量的所有权归多个算子共同持有。
- `struct OpRef` 表示用计算图中的位置引用一个连接到计算图中的算子。
- `struct Unigraph` 表示未分割的计算图或不可再分的最小子图，`push_operator()` 方法用于将算子添加到计算图中，开发者有义务以拓扑序添加算子。
- `struct Mutant` 表示一个候选的子图变异，包含一个子图和该计算图的得分。
- `class Mutation`、`class Rating` 和 `struct Partition` 分别表示计算图的分割、变异和评分。
- `split_each()` 函数将给定的计算图中每个算子转换成一个子图。
- `memory_usage()` 函数计算给定的计算图的内存使用量。
